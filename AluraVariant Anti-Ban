// ==UserScript==
// @name         Alura Destroyer variante anti ban v1
// @namespace    http://tampermonkey.net/
// @version      1.0
// @description  Script para passar as liÃ§Ãµes e concluir unidades lentamente, evitando banimento da plataforma
// @author       AngelHype
// @match        https://cursos.alura.com.br/*
// @grant        none
// ==/UserScript==

(function() {
    'use strict';

    console.log("--- ALURA DESTROYER VARIANT BY angelhype ---");

    // Modifica texto mostrado a cada liÃ§Ã£o
    const waterMark = document.querySelector('.formattedText');
    if (waterMark) {
        waterMark.innerHTML = 'Alura destroyer by Angelhype';
    }

    // ObtÃ©m cookies e URL
    let cookies = document.cookie;
    let actualUrl = window.location.href;
    let nextLessonButton = document.getElementsByClassName("bootcamp-next-button")[0];

    if (nextLessonButton) {
        let nextLessonLink = nextLessonButton.getAttribute('href');
        let parts = actualUrl.split('/');
        let lessonName = parts[4];
        let lessonId = parts[6];
        console.log(`[DEBUG] Lesson_Name: ${lessonName} Lesson_Id: ${lessonId}`);

        // MarcaÃ§Ã£o da liÃ§Ã£o como concluÃ­da
        fetch(`https://cursos.alura.com.br/course/${lessonName}/task/${lessonId}/mark-video`, {
            method: 'POST',
            credentials: 'include',
            headers: {
                'Content-Type': 'application/json',
                'Cookie': cookies
            }
        }).then(data => {
            console.log("[DEBUG] LiÃ§Ã£o concluÃ­da");

            // Aguarda 1,5 segundos antes de avanÃ§ar para a prÃ³xima liÃ§Ã£o
            setTimeout(() => {
                nextLessonButton.click();
                openNextLessonsInNewTabs();
            }, 1500); // Timer de 1,5 segundos

        }).catch(error => {
            console.error("[DEBUG] Falha ao marcar a liÃ§Ã£o:", error);
        });

    } else {
        // Exibe mensagem quando todas as liÃ§Ãµes terminam
        console.log("Todas as liÃ§Ãµes foram concluÃ­das!");
        
    }

    // FunÃ§Ã£o que abre atÃ© 3 prÃ³ximas liÃ§Ãµes em novas abas
    function openNextLessonsInNewTabs() {
        // Coleta todos os links das prÃ³ximas liÃ§Ãµes na pÃ¡gina
        let nextLessonLinks = document.querySelectorAll('.bootcamp-next-button');

        if (nextLessonLinks.length > 0) {
            let openedTabs = 0; // Contador para abas abertas

            nextLessonLinks.forEach((button, index) => {
                if (openedTabs < 3) { // Limita a abertura a 3 abas
                    let link = button.getAttribute('href');
                    if (link) {
                        // Abre o link da prÃ³xima liÃ§Ã£o em uma nova aba
                        window.open(link, '_blank');
                        console.log(`[DEBUG] Nova aba aberta para: ${link}`);
                        openedTabs++;
                    }
                }
            });
        } else {
            // Exibe mensagem quando todas as liÃ§Ãµes terminam
            console.log("[DEBUG] Nenhuma prÃ³xima liÃ§Ã£o encontrada.");
            alert("CrÃ©ditos a Marcos10PC");
            alert("Love MðŸ¤");
        }
    }

})();
